<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
		html,
		body {
			width: 100%;
			height: 100%;
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
	</style>
</head>
<body>
<div id="container" style="width:100%;height:100%"></div>
<script src="https://unpkg.com/monaco-editor@0.7.0/min/vs/loader.js"></script>
<script src="https://unpkg.com/bowser@1.6.0/bowser.min.js"></script>
<script>
  require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@0.7.0/min/vs' }});
  window.get = (module)=>new Promise((f,t)=>require([module],f,t))
  window.awaiter = function awaiter(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}
</script>
<script> awaiter(function* main () {
  const bowser = yield get('bowser'), prefix = '/*******************xbin-start*************************/\n(function () {', suffix = '}())\n/*******************xbin-end*************************/'
  let saving = false

  function getVersion () {
    if (bowser.mac) return 'darwin-x64-6.9.2'
    if (bowser.windows) return 'win32-x64-6.9.2'
    return 'linux-static-ia32-6.9.2'
  }

  function getName (code) {
    const
      suffix = bowser.windows ? '.exe' : '',
      matches = code.match(/\/\/xbin-name (.*)/),
      name = (matches && matches[1] || '').trim()

    return (name || 'my-app') + suffix
  }

  const download = (() => {
    const a = document.createElement('a')
    document.body.appendChild(a)
    a.style = 'display: none'
    return (data, name) => {
      const blob = new Blob(data, { type: 'octet/stream' }),
          url = window.URL.createObjectURL(blob);
      a.href = url
      a.download = name
      a.click()
      setTimeout(() => window.URL.revokeObjectURL(url), 5000)
    }
  })()

  const getXbin = awaiter(function* getXbin () {
    const response = yield fetch(document.location.href + getVersion())
    return response.arrayBuffer()
  })

  yield get('vs/editor/editor.main')
  const editor = window.editor = monaco.editor.create(container, {
    value: [`/***************************************************`,`'                      __      _                   '`,
            `'             _  __   / /_    (_)   ____           '`,`'            | |/_/  / __ |  / /   / __ |          '`,
            `'           _>  <   / /_/ / / /   / / / /          '`,`'          /_/|_|  /_.___/ /_/   /_/ /_/           '`,
            `'            Write some Node.js code!              '`,`'              Press Ctrl+S to save                '`,
            `***************************************************/\n//xbin-name my-app\n`].join('\n'),
    language: 'javascript'
  })
  window.onresize = () => editor.layout()

  const save = awaiter(function* save () {
    if (saving) return
    saving = true
    const code = editor.getModel().getValue(),
      name = getName(code)
    try {
      download([yield getXbin(), prefix, code, suffix], name)
    } catch (e) {
      alert(e)
    } finally {
      saving = false
    }
  })

  document.addEventListener('keydown', e => {
    if (e.which === 83 && e.ctrlKey) {
      e.preventDefault()
      e.stopPropagation()
      !saving && save()
    }
  })
})()</script>
</body>
</html>
